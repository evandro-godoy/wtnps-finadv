# ğŸ—ï¸ Arquitetura Visual - MetaTraderProvider

## 1ï¸âƒ£ Fluxo de InicializaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROGRAMA PRINCIPAL                                             â”‚
â”‚  â”œâ”€ import MetaTraderProvider                                  â”‚
â”‚  â””â”€ provider = MetaTraderProvider()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  __init__()                â”‚
        â”‚  â”œâ”€ LÃª configuraÃ§Ã£o        â”‚
        â”‚  â””â”€ Chama mt5.initialize() â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚
        TRUE â”‚              â”‚ FALSE
             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… SUCESSO   â”‚  â”‚ âŒ FALHA - FAIL FAST   â”‚
    â”‚              â”‚  â”‚                        â”‚
    â”‚ Log: INFO    â”‚  â”‚ Log: CRITICAL          â”‚
    â”‚ Continua     â”‚  â”‚ sys.exit(1)            â”‚
    â”‚              â”‚  â”‚ [ENCERRA PROGRAMA]     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ Fluxo de Busca de Candles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API: get_latest_candles(symbol, timeframe, n)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
          Input: symbol='WDO$', timeframe='M5', n=100
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Validar ConexÃ£o MT5       â”‚
            â”‚ â”œâ”€ mt5.terminal_info()    â”‚
            â”‚ â””â”€ Is None? â†’ Error       â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚          â”‚
            SIM  â”‚          â”‚ NÃƒO
                 â–¼          â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ CONTINUA â”‚  â”‚ ConnectionError  â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Mapear timeframe string      â”‚
    â”‚ 'M5' â†’ mt5.TIMEFRAME_M5      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”‚
    VÃLIDOâ”‚           â”‚ INVÃLIDO
         â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚CONTINUA â”‚  â”‚ ValueError      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Buscar candles do MT5        â”‚
    â”‚ mt5.copy_rates_from_pos()    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚        â”‚
    COM â”‚        â”‚ VAZIO/NULL
    DADOSâ”‚        â”‚
         â–¼        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚CONTINUAâ”‚  â”‚ ValueError   â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Converter para DataFrame        â”‚
    â”‚ Renomear colunas:              â”‚
    â”‚  open â†’ Open                    â”‚
    â”‚  high â†’ High                    â”‚
    â”‚  close â†’ Close                  â”‚
    â”‚  close â†’ Close                  â”‚
    â”‚  tick_volume â†’ Volume           â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Converter tipos:                â”‚
    â”‚ Open, High, Low, Close â†’ float64â”‚
    â”‚ Volume â†’ int64                  â”‚
    â”‚ Index â†’ DatetimeIndex           â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Retornar DataFrame           â”‚
    â”‚                                 â”‚
    â”‚ Index:  timestamp (UTC)         â”‚
    â”‚ Colunas: Open, High, Low,       â”‚
    â”‚          Close, Volume          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ Estrutura da Classe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MetaTraderProvider                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  PRIVATE ATTRIBUTES:                                        â”‚
â”‚  â”œâ”€ _initialized: bool = False                            â”‚
â”‚  â””â”€ _lock: threading.Lock = None                          â”‚
â”‚                                                             â”‚
â”‚  PUBLIC METHODS:                                            â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ __init__()                                            â”‚
â”‚  â”‚  â””â”€ Fail Fast: mt5.initialize() com sys.exit(1)      â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”œâ”€ get_latest_candles(symbol, timeframe, n=100)         â”‚
â”‚  â”‚  â”œâ”€ Validar conexÃ£o                                   â”‚
â”‚  â”‚  â”œâ”€ Mapear timeframe                                  â”‚
â”‚  â”‚  â”œâ”€ Buscar rates do MT5                               â”‚
â”‚  â”‚  â”œâ”€ Converter para DataFrame                          â”‚
â”‚  â”‚  â””â”€ Retornar: pd.DataFrame[Open, High, Low, Close, V] â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”œâ”€ get_latest_candles_as_events(symbol, timeframe, n)   â”‚
â”‚  â”‚  â”œâ”€ Chamar get_latest_candles()                       â”‚
â”‚  â”‚  â”œâ”€ Converter cada linha para MarketDataEvent         â”‚
â”‚  â”‚  â””â”€ Retornar: List[MarketDataEvent]                   â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”œâ”€ publish_to_eventbus(symbol, timeframe, n)            â”‚
â”‚  â”‚  â”œâ”€ Chamar get_latest_candles_as_events()             â”‚
â”‚  â”‚  â”œâ”€ Para cada evento: event_bus.publish()             â”‚
â”‚  â”‚  â””â”€ Log: "Publicados N eventos"                       â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”œâ”€ shutdown()                                            â”‚
â”‚  â”‚  â”œâ”€ mt5.shutdown()                                    â”‚
â”‚  â”‚  â””â”€ Log: "MT5 desconectado"                           â”‚
â”‚  â”‚                                                         â”‚
â”‚  â””â”€ __del__()                                            â”‚
â”‚     â””â”€ Garantir shutdown ao destruir objeto              â”‚
â”‚                                                             â”‚
â”‚  PRIVATE METHODS:                                           â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€ _validate_connection() â†’ bool                         â”‚
â”‚     â””â”€ Retornar: mt5.terminal_info() is not None         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ Fluxo de Dados (OHLCV)

```
MetaTrader 5 Terminal
    â”‚
    â”‚ mt5.copy_rates_from_pos()
    â”‚ â”œâ”€ symbol='WDO$'
    â”‚ â”œâ”€ timeframe=mt5.TIMEFRAME_M5
    â”‚ â””â”€ count=100
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rates (tuple de dicts)           â”‚
â”‚ â”œâ”€ time: 1672531200             â”‚
â”‚ â”œâ”€ open: 100.50                 â”‚
â”‚ â”œâ”€ high: 101.20                 â”‚
â”‚ â”œâ”€ low: 99.00                   â”‚
â”‚ â”œâ”€ close: 100.80                â”‚
â”‚ â”œâ”€ tick_volume: 5000            â”‚
â”‚ â””â”€ ... (outras colunas)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Converter para DataFrame
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataFrame (lowercase colunas)    â”‚
â”‚ â”œâ”€ time: 1672531200             â”‚
â”‚ â”œâ”€ open: 100.50                 â”‚
â”‚ â”œâ”€ high: 101.20                 â”‚
â”‚ â”œâ”€ low: 99.00                   â”‚
â”‚ â”œâ”€ close: 100.80                â”‚
â”‚ â”œâ”€ tick_volume: 5000            â”‚
â”‚ â””â”€ ... (outras)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Renomear colunas + tipos
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataFrame Final (capitalizadas)  â”‚
â”‚                                  â”‚
â”‚ Index: DatetimeIndex             â”‚
â”‚ 2025-01-31 09:00:00              â”‚
â”‚                                  â”‚
â”‚ Colunas:                         â”‚
â”‚ â”œâ”€ Open: float64                â”‚
â”‚ â”œâ”€ High: float64                â”‚
â”‚ â”œâ”€ Low: float64                 â”‚
â”‚ â”œâ”€ Close: float64               â”‚
â”‚ â””â”€ Volume: int64                â”‚
â”‚                                  â”‚
â”‚ Shape: (100, 5)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Pronto para:
           â”œâ”€ Feature engineering
           â”œâ”€ ML models
           â”œâ”€ AnÃ¡lise tÃ©cnica
           â””â”€ Backtesting
```

---

## 5ï¸âƒ£ Ãrvore de DecisÃ£o - Tratamento de Erros

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ get_latest_candles()â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ConexÃ£o vÃ¡lida?     â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                   NÃƒO â”‚              â”‚ SIM
                       â–¼              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ConnectionError  â”‚Continua     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Timeframe vÃ¡lido?       â”‚
                         â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                        NÃƒO â”‚                  â”‚ SIM
                            â–¼                  â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ValueError    â”‚  â”‚Continua     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ MT5 retornou dados?          â”‚
                          â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                         NÃƒO â”‚                         â”‚ SIM
                             â–¼                         â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ValueError    â”‚  â”‚Converter para DataFrameâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Todas as colunas presentes?    â”‚
                          â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                         NÃƒO â”‚                          â”‚ SIM
                             â–¼                          â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ValueError    â”‚  â”‚Retorna DataFrame â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6ï¸âƒ£ Ciclo de Vida do Provider

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FASE 1: IMPORTAÃ‡ÃƒO                                        â”‚
â”‚                                                           â”‚
â”‚ from src.data_handler.mt5_provider import \              â”‚
â”‚   MetaTraderProvider                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FASE 2: INSTANCIAÃ‡ÃƒO (Fail Fast aqui!)                  â”‚
â”‚                                                           â”‚
â”‚ provider = MetaTraderProvider()                          â”‚
â”‚   â”œâ”€ LÃª configuraÃ§Ã£o (.env)                             â”‚
â”‚   â”œâ”€ Tenta mt5.initialize()                             â”‚
â”‚   â”‚   â”œâ”€ âœ… Sucesso â†’ Log INFO + Continua              â”‚
â”‚   â”‚   â””â”€ âŒ Falha â†’ Log CRITICAL + sys.exit(1)          â”‚
â”‚   â””â”€ _initialized = True                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FASE 3: USO DO PROVIDER                                   â”‚
â”‚                                                           â”‚
â”‚ df = provider.get_latest_candles('WDO$', 'M5', 100)      â”‚
â”‚     â”œâ”€ Busca dados                                       â”‚
â”‚     â””â”€ Retorna DataFrame                                 â”‚
â”‚                                                           â”‚
â”‚ events = provider.get_latest_candles_as_events(...)       â”‚
â”‚     â”œâ”€ Busca dados                                       â”‚
â”‚     â””â”€ Retorna List[MarketDataEvent]                     â”‚
â”‚                                                           â”‚
â”‚ provider.publish_to_eventbus('WDO$', 'M5', 50)          â”‚
â”‚     â”œâ”€ Busca dados                                       â”‚
â”‚     â””â”€ Publica no EventBus                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FASE 4: ENCERRAMENTO                                      â”‚
â”‚                                                           â”‚
â”‚ provider.shutdown()                                      â”‚
â”‚   â”œâ”€ Chama mt5.shutdown()                               â”‚
â”‚   â”œâ”€ _initialized = False                               â”‚
â”‚   â””â”€ Log: "MT5 desconectado"                            â”‚
â”‚                                                           â”‚
â”‚ del provider  (automÃ¡tico ao final do escopo)           â”‚
â”‚   â”œâ”€ Chama __del__()                                    â”‚
â”‚   â””â”€ Garante shutdown seguro                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7ï¸âƒ£ Matriz de Requisitos vs ImplementaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Requisito      â”‚ LocalizaÃ§Ã£o          â”‚ Status   â”‚ Teste       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ConexÃ£o     â”‚ __init__() linha 37  â”‚ âœ…       â”‚ test_succssful_
â”‚    MT5         â”‚ mt5.initialize()     â”‚ PRONTO   â”‚ initializationâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Fail Fast   â”‚ __init__() linha 76  â”‚ âœ…       â”‚ test_fail_fastâ”‚
â”‚    sys.exit(1) â”‚ Sistema encerra      â”‚ PRONTO   â”‚ _on_init_failâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. Interface   â”‚ get_latest_candles() â”‚ âœ…       â”‚ test_get_latest
â”‚    DataFrame   â”‚ linha 139            â”‚ PRONTO   â”‚ _candles_    â”‚
â”‚                â”‚ Retorna pd.DataFrame â”‚          â”‚ returns_...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8ï¸âƒ£ Mapa de IntegraÃ§Ã£o com Sistema

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   AplicaÃ§Ã£o      â”‚
                        â”‚   Principal      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MetaTraderProvider     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚ MT5 Terminal â”‚ â”‚ EventBus   â”‚ â”‚ DataFrame  â”‚
        â”‚              â”‚ â”‚  (opcional)â”‚ â”‚   (Output) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
                â”‚                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ LSTMAdapter        â”‚ (Feature engineering)
    â”‚ SimulationEngine   â”‚ (Backtesting)
    â”‚ LiveTrader         â”‚ (Trading ao vivo)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9ï¸âƒ£ Timeframes Suportados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Timeframes VÃ¡lidos                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  MINUTOS:                               â”‚
â”‚  â”œâ”€ M1   (1 minuto)                     â”‚
â”‚  â”œâ”€ M5   (5 minutos)   â† Mais comum    â”‚
â”‚  â”œâ”€ M15  (15 minutos)  â† Comum         â”‚
â”‚  â””â”€ M30  (30 minutos)                   â”‚
â”‚                                         â”‚
â”‚  HORAS:                                 â”‚
â”‚  â”œâ”€ H1   (1 hora)                       â”‚
â”‚  â””â”€ H4   (4 horas)                      â”‚
â”‚                                         â”‚
â”‚  DIÃRIO E SUPERIOR:                     â”‚
â”‚  â”œâ”€ D1   (1 dia)       â† Comum         â”‚
â”‚  â”œâ”€ W1   (1 semana)                     â”‚
â”‚  â””â”€ MN1  (1 mÃªs)                        â”‚
â”‚                                         â”‚
â”‚  INVÃLIDOS:                             â”‚
â”‚  â”œâ”€ M2, M3, M4 (nÃ£o existem)            â”‚
â”‚  â”œâ”€ H2, H3 (nÃ£o existem)                â”‚
â”‚  â”œâ”€ ABC, INVALID (erro)                 â”‚
â”‚  â””â”€ "" (vazio)                          â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Ÿ PadrÃ£o de Erro & Logging

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOGGING ESTRUTURADO                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  CRITICAL:                                              â”‚
â”‚  â”œâ”€ MT5 initialization failure â†’ sys.exit(1)           â”‚
â”‚  â””â”€ Falha na dependÃªncia crÃ­tica                        â”‚
â”‚                                                         â”‚
â”‚  ERROR:                                                 â”‚
â”‚  â”œâ”€ Timeframe invÃ¡lido                                 â”‚
â”‚  â”œâ”€ MT5 desconectado durante operaÃ§Ã£o                 â”‚
â”‚  â”œâ”€ Sem dados retornado                               â”‚
â”‚  â””â”€ Colunas faltando                                  â”‚
â”‚                                                         â”‚
â”‚  INFO:                                                  â”‚
â”‚  â”œâ”€ MT5 inicializado com sucesso                      â”‚
â”‚  â”œâ”€ Candles buscados (debug level)                    â”‚
â”‚  â””â”€ MT5 desconectado com sucesso                      â”‚
â”‚                                                         â”‚
â”‚  DEBUG:                                                 â”‚
â”‚  â”œâ”€ Candles buscados (count)                          â”‚
â”‚  â”œâ”€ Eventos publicados (count)                        â”‚
â”‚  â””â”€ Detalhes operacionais                             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Criado:** 31/01/2026  
**VersÃ£o:** 1.0  
**Tipo:** Arquitetura Visual
